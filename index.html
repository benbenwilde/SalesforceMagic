<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>SalesforceMagic by clamidity</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>SalesforceMagic</h1>
        <h2>Easy access to various Salesforce APIs.</h2>
        <a href="https://github.com/clamidity/SalesforceMagic" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="salesforce-magic" class="anchor" href="#salesforce-magic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Salesforce Magic</h1>

<p>While dealing with Salesforce I realized that there aren't any decent libraries that can communicate using the various APIs. This library is intended to be a simple, solid, and small library that encompasses and provides access to the SOAP, REST and Bulk API's for Salesforce. The magic lies in the library's ability to dynamically generate SOQL queries based on generic types and also the dynamic generation of the SOAP wsdl. You will never have to replace or update a wsdl again.</p>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<p><a href="https://www.nuget.org/packages/SalesforceMagic">Nuget</a> =&gt; PM&gt; Install-Package SalesforceMagic</p>

<h3>
<a id="currently-implemented-features" class="anchor" href="#currently-implemented-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Currently Implemented Features</h3>

<ul>
<li>Dynamic SOQL query generation based on generic type interpretation</li>
<li>Expression and predicate visitation allowing users to create both simple and complicated where conditions using powerful lambda expressions.</li>
<li>SOAP Login and Session ID Retrieval</li>
<li>SOAP Query based on generic types.</li>
<li>Re-implementable storage for reusing session details.</li>
</ul>

<h3>
<a id="example-usage" class="anchor" href="#example-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example Usage</h3>

<p>Start by setting up the configuration and Salesforce client:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-s">public</span> <span class="pl-st">void</span> Main()
{
    <span class="pl-k">var</span> config = <span class="pl-s">new</span> SalesforceConfig
    {
        Username = <span class="pl-s1"><span class="pl-pds">"</span>salesforceUsername<span class="pl-pds">"</span></span>,
        Password = <span class="pl-s1"><span class="pl-pds">"</span>salesforcePassword<span class="pl-pds">"</span></span>,
        IsSandbox = <span class="pl-c1">true</span>
    }

    <span class="pl-k">using</span> (SalesforceClient client = <span class="pl-s">new</span> SalesforceClient(config))
    {
        <span class="pl-c">// Salesforce logic</span>
    }     
}</pre></div>

<p>Let's grab the session id:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-st">string</span> sessionId = client.GetSessionId();</pre></div>

<p>We can use the session id if we want, but the method automatically uses the last session id retrieved as long as it is not stale. For example, let's grab 5 vAttachments. We'll start by creating a C# class to represent out vAttachment. SalesforceMagic provides custom attributes that allow you to have pretty and simple classes while mapping to custom field names in Salesforce:</p>

<div class="highlight highlight-csharp"><pre>[SalesforceName(<span class="pl-s1"><span class="pl-pds">"</span>vAttachment__c<span class="pl-pds">"</span></span>)]
<span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">vAttachment</span> : <span class="pl-st">SObject</span>
{
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

    [SalesforceName(<span class="pl-s1"><span class="pl-pds">"</span>Filename__c<span class="pl-pds">"</span></span>)]
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">FileName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

    [SalesforceName(<span class="pl-s1"><span class="pl-pds">"</span>s3Id__c<span class="pl-pds">"</span></span>)]
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">S3Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>

<p>Now let's actually perform the query, we'll grab 5 vAttachments and set a condition to ensure that the records we retrieve have the S3Id field set:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-k">var</span> attachments = client.Query&lt;vAttachment&gt;(x =&gt; x.S3Id != <span class="pl-c1">null</span>, limit: <span class="pl-c1">5</span>);</pre></div>

<p>Let's also go over the use of CRUD operations using both the SOAP and Bulk apis.
First let's create a list of objects we can use.</p>

<div class="highlight highlight-csharp"><pre>vAttachment[] attachments = <span class="pl-s">new</span> []
{
    <span class="pl-s">new</span> vAttachment
    {
        FileName = <span class="pl-s1"><span class="pl-pds">"</span>Test.pdf<span class="pl-pds">"</span></span>,
        S3Id = <span class="pl-s1"><span class="pl-pds">"</span>123456789<span class="pl-pds">"</span></span>
    },
    <span class="pl-s">new</span> vAttachment
    {
        FileName = <span class="pl-s1"><span class="pl-pds">"</span>Test-2.pdf<span class="pl-pds">"</span></span>,
        S3Id = <span class="pl-s1"><span class="pl-pds">"</span>abcdefghij<span class="pl-pds">"</span></span>
    },
    ...
}</pre></div>

<p>SOAP API: Using the SOAP api for CRUD operations is very simple. It can easily deal with individual sObjects or an array.</p>

<div class="highlight highlight-csharp"><pre>SalesforceResponse response = client.PerformCrudOperation(attachments, CrudOperations.Insert);</pre></div>

<p>BULK API: Interaction with the bulk api is slightly different. In order to use the bulk api you'll need to start a data load job:</p>

<div class="highlight highlight-csharp"><pre>JobInfo jobInfo = client.CreateBulkJob&lt;vAttachment&gt;(<span class="pl-s">new</span> JobConfig
{
    ConcurrencyMode = ConcurrencyMode.Parallel,
    Operation = BulkOperations.Insert
});</pre></div>

<p>Starting a job will return a JobInfo object:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">JobInfo</span>
{
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">Operation</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">Object</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">CreatedById</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> DateTime <span class="pl-en">CreatedDate</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> JobState <span class="pl-en">State</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> ConcurrencyMode <span class="pl-en">ConcurrencyMode</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">ContentType</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedQueued</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedInProgress</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedCompleted</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedFailed</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedTotal</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberBatchedProcessed</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberRetries</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">ApiVersion</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>

<p>The most important part of the object is the Id. This is used to add batches to the job:</p>

<div class="highlight highlight-csharp"><pre>BatchInfo batchInfo = client.AddBatch(attachments, jobInfo.Id);</pre></div>

<p>This will queue a batch operation in the specified job. It returns a BatchInfo object:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">BatchInfo</span>
{
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">JobId</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">string</span> <span class="pl-en">State</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> DateTime <span class="pl-en">CreatedDate</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">NumberRecordsProcessed</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>

<p>Once you have added the necessary batches to the job you will need to close it:</p>

<div class="highlight highlight-csharp"><pre>SalesforceResponse jobCloseResponse = client.CloseBulkJob(jobInfo.Id);</pre></div>

<p>That's it! This will return an IEnumerable of 5 vAttachment objects. You can add more fields, remove fields, add more complex conditions. The sky is the limit!</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/clamidity/SalesforceMagic/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/clamidity/SalesforceMagic/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/clamidity/SalesforceMagic"></a> is maintained by <a href="https://github.com/clamidity">clamidity</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-56910206-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
